<script>
    const API_BASE_URL = "https://73a5-93-66-99-217.ngrok-free.app";
    
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('audioFile');
    const outputDiv = document.getElementById('transcriptionOutput');
    
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('uploading');
    });
    
    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('uploading');
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('uploading');
        const files = e.dataTransfer.files;
        if (files.length) {
            fileInput.files = files;
            updateFileName(files[0].name);
        }
    });
    
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            updateFileName(e.target.files[0].name);
        }
    });
    
    function updateFileName(fileName) {
        document.querySelector('.upload-text').textContent = `File selezionato: ${fileName}`;
    }
    
    async function transcribeAudio() {
        if (!fileInput.files.length) {
            outputDiv.textContent = "Per favore, seleziona un file audio.";
            return;
        }
        
        const file = fileInput.files[0];
        outputDiv.textContent = "Trascrizione in corso...";
        dropZone.classList.add('uploading');
        
        try {
            const formData = new FormData();
            formData.append('file', file);
    
            const response = await fetch(`${API_BASE_URL}/upload/`, {
                method: 'POST',
                body: formData,
            });
    
            if (!response.ok) {
                throw new Error('Errore durante la trascrizione.');
            }
    
            const data = await response.json();
            outputDiv.textContent = data.transcription;
        } catch (error) {
            outputDiv.textContent = `Errore: ${error.message}`;
        } finally {
            dropZone.classList.remove('uploading');
        }
    }
    </script>